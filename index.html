<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    hola mundo

    <div class="fb-send-to-messenger" 
      messenger_app_id="612888230928436" 
      page_id="109419601639318" 
      data-ref="6645564186"
       
      color="blue" 
      cta_text="MESSAGE_ME"
      size="standard">
    </div>
</body>

<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId            : '612888230928436',
      autoLogAppEvents : true,
      xfbml            : true,
      version          : 'v17.0'
    });
    
    FB.Event.subscribe('send_to_messenger', async function(e) {
      // callback for events triggered by the plugin
      if(e.event == 'opt_in'){
        console.log('hola, ya se mando el mensaje')
        console.log(e.ref)

        const url = `https://242a-189-202-71-25.ngrok-free.app/api/v1/messenger/welcome-message/${e.ref}`
        const response = await fetch(url,{method:'POST'})
      }
    });
  };


</script>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
</html>